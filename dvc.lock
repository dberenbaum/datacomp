schema: '2.0'
stages:
  filter:
    cmd: python baselines.py --metadata_dir /mnt/efs/dvcx-datacomp-sandbox-small/metadata
      --save_path filter.npy --name basic_filter
    deps:
    - path: /mnt/efs/dvcx-datacomp-sandbox-small/metadata
      hash: md5
      md5: 7ac49b54aa3ff0b49d3875a8a2c4b4e7.dir
      size: 81707590807
      nfiles: 52
    - path: baselines.py
      hash: md5
      md5: 6977d713479d33e3467a2f031716ac79
      size: 5620
    outs:
    - path: filter.npy
      hash: md5
      md5: d64237f202666bf294100aacc55cb28f
      size: 47706400
  reshard:
    cmd:
    - mkdir -p /mnt/efs/subset/shards
    - python resharder.py -i /mnt/efs/dvcx-datacomp-sandbox-small/shards -o /mnt/efs/subset/shards
      -s filter.npy
    deps:
    - path: /mnt/efs/dvcx-datacomp-sandbox-small/shards
      hash: md5
      md5: 13962d1e7fa97d6e21453bcf1adb7c54.dir
      size: 445535060163
      nfiles: 3863
    - path: filter.npy
      hash: md5
      md5: d64237f202666bf294100aacc55cb28f
      size: 47706400
    - path: resharder.py
      hash: md5
      md5: d237a5fa5720478aa5ddab24f640e26f
      size: 36484
    outs:
    - path: /mnt/efs/subset/shards
      hash: md5
      md5: c49ef0034ce7232bf5c92e2172fd9009.dir
      size: 141179867413
      nfiles: 534
  train:
    cmd: sbatch --wait --nodes 1 --ntasks-per-node 4 --cpus-per-task 6 --constraint
      p3.16xlarge slurm_train.sh /mnt/efs/subset/shards train
    deps:
    - path: /mnt/efs/subset/shards
      hash: md5
      md5: c49ef0034ce7232bf5c92e2172fd9009.dir
      size: 141179867413
      nfiles: 534
    - path: slurm_train.sh
      hash: md5
      md5: c44bb30b2648e98c0859aafc0d15e368
      size: 1522
    - path: train.py
      hash: md5
      md5: 27470ea75a5a51f50fcf68576bfaf45e
      size: 10438
    outs:
    - path: train
      hash: md5
      md5: 7f6ab0c8ed18cb6b6dfc53843814d86d.dir
      size: 3631372640
      nfiles: 5
  eval:
    cmd: sbatch --wait --nodes 1 --ntasks 1 --cpus-per-task 8 --gpus 1 --mem 32G --constraint
      p3.2xlarge slurm_evaluate.sh train /mnt/efs/eval_dataset eval
    deps:
    - path: /mnt/efs/eval_dataset
      hash: md5
      md5: cf80882eebc1f9a2d78435bd91ed64ac.dir
      size: 140744631536
      nfiles: 14370
    - path: evaluate.py
      hash: md5
      md5: 9335b353ff76a58ac4e1473e69bfc47b
      size: 15566
    - path: slurm_evaluate.sh
      hash: md5
      md5: c0c0b67b025f35eaaf336d5c0d78f36a
      size: 607
    - path: train
      hash: md5
      md5: 7f6ab0c8ed18cb6b6dfc53843814d86d.dir
      size: 3631372640
      nfiles: 5
    outs:
    - path: eval/eval_results.json
      hash: md5
      md5: f7b4c3ea2602fda962eb350f1e88ec17
      size: 15749
    - path: eval/eval_results.jsonl
      hash: md5
      md5: 99c018aaca65a0031805e598bcee8d56
      size: 16869
